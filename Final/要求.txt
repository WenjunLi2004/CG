你是一名资深 OpenGL 图形程序员，需要阅读并理解 `/Users/wenjun/Documents/CG` 仓库中已有的全部实验（Experiment1~4、Experiment3.x、Experiment4.1、补充1/2 等），在当前基础上规划并完成期末机械臂实验室场景。仓库已经提供了以下现成技术，请充分复用：

1. **层级建模基础**（`补充1/2023150001_李文俊_实验补充一/code`）：`MeshPainter + TriMesh + Camera + Light` 已经实现底座 / 大臂 / 小臂三层层次变换、键盘切换部件（1/2/3）和 A/S 调角的逻辑。该部分是最终机械臂的出发点，需要升级为包含基座、下臂、上臂、手爪乃至末端工具的 4~5 层结构。
2. **多部件层级与矩阵栈**（`补充2`）：示例了 `MatrixStack` 的使用方式、关节状态数组与键盘映射，可借鉴到机械臂和未来扩展（例如控制夹爪指节）。
3. **Phong 光照 / 阴影投影**（`Experiment3`、`Experiment3.4`）：仓库已有 `Light`、材质结构、`isShadow` uniform 等代码，请以这些实现为模板完成聚光灯、实时阴影以及阴影贴图。
4. **纹理贴图与 ogl 管线**（`Experiment4.1`）：`assets` 目录已经放置若干贴图样例（PNG/JPG），含有 `MeshPainter` 的纹理加载流程。最终项目需要新增金属格栅与混凝土贴图（可沿用 `stb_image` 或已有加载器）并放在 `Final/assets/textures` 目录。
5. **相机交互**（`Experiment3.1` 及其他工程）：`Camera` 类同时支持键盘/鼠标控制（u/i/o 调角度、scroll/鼠标左键绕行）。最终项目直接复用该类，实现自由观察。

---

## 终版场景设想
- 场景类型：封闭式金属实验室（类似机械臂维护间），地面使用金属格栅，四周墙体使用混凝土或金属板纹理，顶面可以采用同墙体纹理或做暗处理。
- 核心物体：一台机械臂（基座 + 下臂 + 上臂 + 手爪）放置在中央工作台，旁边可摆放若干辅助几何体（工具台、箱子、灯罩）来丰富画面。
- 光照：实验室上方安装一盏主聚光灯（默认位置 `(0, 2.5, 0)`，指向 `(0, -1, 0)`），必要时可加一盏填充点光源平衡亮度。
- 交互：观众可绕场景查看，使用键盘独立控制各关节，展示层级传递、材质、纹理和阴影的综合效果。

---

## 必做功能
1. **工程结构/依赖**
   - 继续沿用仓库现有的 `CMake + GLFW + GLAD + GLM + stb_image` 架构；窗口标题改为 `学号_姓名_期末大作业`。
   - 代码组织建议：`Final/src`（C++）、`Final/shaders`（GLSL）、`Final/assets`（模型/纹理），并提供 `build` 目录的构建说明。
   - 复用 `Camera`、`Light`、`TriMesh`、`MeshPainter` 类，必要时在 `include/` 下扩展宏或新组件，但保持接口风格与已有实验一致。

2. **层级机械臂建模**
   - 机械臂组成：基座（圆柱/长方体）、下臂（肩 → 肘）、上臂（肘 → 腕）、手爪（两片夹爪或自定义末端执行器），至少 4 层节点。
   - 建模尺寸参考补充实验：基座半径 ≈0.4、高0.25；下臂长0.5；上臂长0.4；夹爪长度0.15，所有尺寸可在 `const` 中集中配置。
   - 各节点矩阵链：`Model = ParentModel * Translate(joint) * Rotate(axis) * LocalScale`；请在代码中配注释说明每一步变换的意义。
   - 初始姿态：基座朝 +Z，臂部自然向前伸展 30°；需要提供 `reset()` 功能将所有角度恢复默认。

3. **关节交互**
   - 键盘映射建议：
     - `1 / 2`：基座逆/顺时针（绕 Y 轴）旋转，范围 [0°, 360°)。
     - `3 / 4`：下臂俯仰（绕局部 Z 轴）范围 [-60°, +75°]。
     - `5 / 6`：上臂俯仰范围 [-45°, +90°]。
     - `7 / 8`：手爪开合，范围 [10°, 60°]。
   - 每次按键调整 5°，在 `HUD` 或 `std::cout` 打印当前角度，方便答辩展示。实验室允许额外绑定鼠标滚轮或 GUI 控件，但需保留键盘方案。

4. **纹理与材质**
   - 在 `Final/assets/textures/` 下新增：`metal_grate.png`（地面，建议 1024x1024）与 `concrete_wall.jpg`（墙面，2048x2048）。若需额外粗糙度/法线贴图，可一并放置并标注用途。
   - 地面使用重复 UV（如 `texCoord * 5`）以体现格栅细节；墙面使用竖直平铺，并留意顶点 UV 的连贯性。
   - 机械臂采用金属材质（调整 `material.diffuse/specular/shininess`），可叠加简单纹理或颜色渐变，需保证与光照配合自然。

5. **聚光灯 + 阴影映射**
   - 主光源：聚光位置 `(0, 2.5, 0)`、方向 `(0, -1, 0)`、内/外切角 `15°/20°`、常规衰减 `(1.0, 0.09, 0.032)`。
   - 阴影贴图：至少 1024×1024 深度纹理，使用 `Framebuffer Object` 渲染。主渲染阶段将片元位置乘以 `lightSpaceMatrix` 与深度比较，含 `bias` + 3x3 PCF 抗锯齿。
   - 需在 C++ 端实现深度帧缓冲创建、光源视图投影矩阵计算，并在 GLSL 中加入 `sampler2D shadowMap` 与 `shadowFactor` 计算。
   - 采用多边形偏移或正面剔除缓解彼得潘效应，并在代码里注明策略。

6. **相机/场景交互**
   - 继续使用 `Camera` 类：`u/i/b`（或 `u/i/o`）控制绕行角度与距离；鼠标左键拖动时可做轨迹球旋转；`scroll` 控制缩放。
   - 提供快捷键：`H` 打印帮助、`Space` 重置相机、`F` 将相机对准机械臂末端。
   - 允许 WASD 在水平面平移，以展示地面纹理与墙体效果。

7. **界面与辅助元素**
   - 在屏幕左上角用 `ImGui`、`TextRenderer` 或 `glfwSetWindowTitle` 实时显示：当前帧率、相机距离、各关节角度、光照开关状态。
   - 可选：添加 `工具台/储物箱/安全围栏` 等简单 TriMesh 模块，丰富场景层次；若实现需在报告中标明。

---

## 交付与文档
1. **代码**：`Final/` 目录需可直接 `cmake .. && make` 编译，README 中写清运行方法、依赖、键鼠映射、资源路径。
2. **答辩演示顺序**（对应课程要求）：
   - ① 场景与层级结构说明（展示基座 → 臂 → 爪的矩阵传递）。
   - ② 纹理效果展示（地面/墙体特写）。
   - ③ 光照 + 阴影展示（切换聚光灯角度或关闭阴影对比）。
   - ④ 相机交互展示（绕场景、缩放、聚焦）。
   - ⑤ 关节控制展示，说明父子节点联动。
   - ⑥ 若有附加功能（GUI、粒子、额外模型），逐项演示。
3. **文档/截图**：按照课程要求准备过程说明、使用说明书、代表性截图、层次结构框图，并确保命名规范（`学号_姓名_...`）。

---

请在实现结束后提供：
- C++/GLSL 关键代码片段与说明（尤其是层级矩阵、阴影映射片段）。
- 测试/操作说明：如何验证每个功能（纹理、光照、阴影、交互）。
- 思路总结：如何从各实验迁移代码、主要难点与解决办法。
